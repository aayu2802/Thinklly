{% extends 'akademi/elements/layouts/admin.html' %}

{% block title %}Issued Books - Library{% endblock %}

{% block content %}
<!--**********************************
    Content body start
***********************************-->
<div class="content-body">
<div class="container-fluid">
    <div class="row page-titles">
        <div class="col-md-8">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('school.dashboard', tenant_slug=tenant_slug) }}">Dashboard</a></li>
                <li class="breadcrumb-item"><a href="{{ url_for('school.library_dashboard', tenant_slug=tenant_slug) }}">Library</a></li>
                <li class="breadcrumb-item active">Issued Books</li>
            </ol>
        </div>
        <div class="col-md-4 text-end">
            <a href="{{ url_for('school.issue_library_book', tenant_slug=tenant_slug) }}" class="btn btn-success">
                <i class="bi bi-plus-circle"></i> Issue New Book
            </a>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h4 class="card-title"><i class="bi bi-book"></i> Currently Issued Books <span class="badge bg-primary">{{ issues|length }}</span></h4>
        </div>
        <div class="card-body">
            {% if issues %}
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-primary">
                        <tr>
                            <th>Issue #</th>
                            <th>Book Details</th>
                            <th>Student</th>
                            <th>Issue Date</th>
                            <th>Due Date</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for issue in issues %}
                        <tr {% if issue.is_overdue %}class="table-warning"{% endif %}>
                            <td><strong class="text-primary">{{ issue.issue_number }}</strong></td>
                            <td>
                                <strong>{{ issue.book.title }}</strong><br>
                                <small class="text-muted">{{ issue.book.accession_number }}</small>
                            </td>
                            <td>
                                <a href="{{ url_for('school.student_library_history', tenant_slug=tenant_slug, student_id=issue.student.id) }}" class="text-decoration-none">
                                    <i class="bi bi-person"></i> {{ issue.student.full_name }}
                                </a><br>
                                <small class="text-muted">{{ issue.student.admission_number }}</small>
                            </td>
                            <td>{{ issue.issue_date.strftime('%d %b %Y') }}</td>
                            <td>
                                {{ issue.due_date.strftime('%d %b %Y') }}
                                {% if issue.is_overdue %}
                                <br><span class="badge bg-danger"><i class="bi bi-exclamation-triangle"></i> {{ issue.days_overdue }} days late</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if issue.is_overdue %}
                                <span class="badge bg-danger">Overdue</span>
                                {% else %}
                                <span class="badge bg-success">Active</span>
                                {% endif %}
                            </td>
                            <td>
                                <a href="{{ url_for('school.return_library_book', tenant_slug=tenant_slug, issue_id=issue.id) }}" 
                                   class="btn btn-primary btn-sm">
                                    <i class="bi bi-arrow-return-left"></i> Return
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center py-5">
                <i class="bi bi-inbox display-1 text-muted"></i>
                <p class="lead text-muted">No books currently issued</p>
                <a href="{{ url_for('school.issue_library_book', tenant_slug=tenant_slug) }}" class="btn btn-success">
                    <i class="bi bi-plus-circle"></i> Issue First Book
                </a>
            </div>
            {% endif %}
        </div>
    </div>
</div>
</div>
<!--**********************************
    Content body end
***********************************-->
{% endblock %}
